Object.defineProperty(exports, '__esModule', {
  value: true
});
exports.shouldTriggerLinter = shouldTriggerLinter;
exports.getEditorCursorScopes = getEditorCursorScopes;
exports.isPathIgnored = isPathIgnored;
exports.subscriptiveObserve = subscriptiveObserve;
exports.messageKey = messageKey;
exports.normalizeMessages = normalizeMessages;

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { 'default': obj }; }

var _lodashUniq = require('lodash/uniq');

var _lodashUniq2 = _interopRequireDefault(_lodashUniq);

var _atom = require('atom');

var $version = '__$sb_linter_version';
exports.$version = $version;
var $activated = '__$sb_linter_activated';
exports.$activated = $activated;
var $requestLatest = '__$sb_linter_request_latest';
exports.$requestLatest = $requestLatest;
var $requestLastReceived = '__$sb_linter_request_last_received';

exports.$requestLastReceived = $requestLastReceived;

function shouldTriggerLinter(linter, wasTriggeredOnChange, scopes) {
  if (wasTriggeredOnChange && !linter.lintsOnChange) {
    return false;
  }
  return scopes.some(function (scope) {
    return linter.grammarScopes.includes(scope);
  });
}

function getEditorCursorScopes(textEditor) {
  return (0, _lodashUniq2['default'])(textEditor.getCursors().reduce(function (scopes, cursor) {
    return scopes.concat(cursor.getScopeDescriptor().getScopesArray());
  }, ['*']));
}

var minimatch = undefined;

function isPathIgnored(filePath, ignoredGlob, ignoredVCS) {
  if (!filePath) {
    return true;
  }

  if (ignoredVCS) {
    var repository = null;
    var projectPaths = atom.project.getPaths();
    for (var i = 0, _length2 = projectPaths.length; i < _length2; ++i) {
      var projectPath = projectPaths[i];
      if (filePath.indexOf(projectPath) === 0) {
        repository = atom.project.getRepositories()[i];
        break;
      }
    }
    if (repository && repository.isPathIgnored(filePath)) {
      return true;
    }
  }
  var normalizedFilePath = process.platform === 'win32' ? filePath.replace(/\\/g, '/') : filePath;
  if (!minimatch) {
    minimatch = require('minimatch');
  }
  return minimatch(normalizedFilePath, ignoredGlob);
}

function subscriptiveObserve(object, eventName, callback) {
  var subscription = null;
  var eventSubscription = object.observe(eventName, function (props) {
    if (subscription) {
      subscription.dispose();
    }
    subscription = callback.call(this, props);
  });

  return new _atom.Disposable(function () {
    eventSubscription.dispose();
    if (subscription) {
      subscription.dispose();
    }
  });
}

function messageKey(message) {
  var reference = message.reference;

  return ['$LINTER:' + message.linterName, '$LOCATION:' + message.location.file + '$' + message.location.position.start.row + '$' + message.location.position.start.column + '$' + message.location.position.end.row + '$' + message.location.position.end.column, reference ? '$REFERENCE:' + reference.file + '$' + (reference.position ? reference.position.row + '$' + reference.position.column : '') : '$REFERENCE:null', '$EXCERPT:' + message.excerpt, '$SEVERITY:' + message.severity, message.icon ? '$ICON:' + message.icon : '$ICON:null', message.url ? '$URL:' + message.url : '$URL:null', typeof message.description === 'string' ? '$DESCRIPTION:' + message.description : '$DESCRIPTION:null'].join('');
}

function normalizeMessages(linterName, messages) {
  for (var i = 0, _length3 = messages.length; i < _length3; ++i) {
    var message = messages[i];
    var reference = message.reference;

    if (Array.isArray(message.location.position)) {
      message.location.position = _atom.Range.fromObject(message.location.position);
    }
    if (reference && Array.isArray(reference.position)) {
      reference.position = _atom.Point.fromObject(reference.position);
    }
    if (message.solutions && message.solutions.length) {
      for (var j = 0, _length = message.solutions.length, solution = undefined; j < _length; j++) {
        solution = message.solutions[j];
        if (Array.isArray(solution.position)) {
          solution.position = _atom.Range.fromObject(solution.position);
        }
      }
    }
    message.version = 2;
    if (!message.linterName) {
      message.linterName = linterName;
    }
    message.key = messageKey(message);
  }
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy93aWxsL2RvdGZpbGVzLy5hdG9tL3BhY2thZ2VzL2xpbnRlci9saWIvaGVscGVycy5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7MEJBRXdCLGFBQWE7Ozs7b0JBQ0ksTUFBTTs7QUFJeEMsSUFBTSxRQUFRLEdBQUcsc0JBQXNCLENBQUE7O0FBQ3ZDLElBQU0sVUFBVSxHQUFHLHdCQUF3QixDQUFBOztBQUMzQyxJQUFNLGNBQWMsR0FBRyw2QkFBNkIsQ0FBQTs7QUFDcEQsSUFBTSxvQkFBb0IsR0FBRyxvQ0FBb0MsQ0FBQTs7OztBQUVqRSxTQUFTLG1CQUFtQixDQUFDLE1BQWMsRUFBRSxvQkFBNkIsRUFBRSxNQUFxQixFQUFXO0FBQ2pILE1BQUksb0JBQW9CLElBQUksQ0FBQyxNQUFNLENBQUMsYUFBYSxFQUFFO0FBQ2pELFdBQU8sS0FBSyxDQUFBO0dBQ2I7QUFDRCxTQUFPLE1BQU0sQ0FBQyxJQUFJLENBQUMsVUFBUyxLQUFLLEVBQUU7QUFDakMsV0FBTyxNQUFNLENBQUMsYUFBYSxDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUMsQ0FBQTtHQUM1QyxDQUFDLENBQUE7Q0FDSDs7QUFFTSxTQUFTLHFCQUFxQixDQUFDLFVBQXNCLEVBQWlCO0FBQzNFLFNBQU8sNkJBQ0wsVUFBVSxDQUFDLFVBQVUsRUFBRSxDQUFDLE1BQU0sQ0FBQyxVQUFDLE1BQU0sRUFBRSxNQUFNO1dBQUssTUFBTSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsa0JBQWtCLEVBQUUsQ0FBQyxjQUFjLEVBQUUsQ0FBQztHQUFBLEVBQUUsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUN2SCxDQUFBO0NBQ0Y7O0FBRUQsSUFBSSxTQUFTLFlBQUEsQ0FBQTs7QUFDTixTQUFTLGFBQWEsQ0FBQyxRQUFpQixFQUFFLFdBQW1CLEVBQUUsVUFBbUIsRUFBVztBQUNsRyxNQUFJLENBQUMsUUFBUSxFQUFFO0FBQ2IsV0FBTyxJQUFJLENBQUE7R0FDWjs7QUFFRCxNQUFJ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QUFDLFFBQVEsQ0FBQyxRQUFRLENBQUMsQ0FBQTtTQUN4RDtPQUNGO0tBQ0Y7QUFDRCxXQUFPLENBQUMsT0FBTyxHQUFHLENBQUMsQ0FBQTtBQUNuQixRQUFJLENBQUMsT0FBTyxDQUFDLFVBQVUsRUFBRTtBQUN2QixhQUFPLENBQUMsVUFBVSxHQUFHLFVBQVUsQ0FBQTtLQUNoQztBQUNELFdBQU8sQ0FBQyxHQUFHLEdBQUcsVUFBVSxDQUFDLE9BQU8sQ0FBQyxDQUFBO0dBQ2xDO0NBQ0YiLCJmaWxlIjoiL1VzZXJzL3dpbGwvZG90ZmlsZXMvLmF0b20vcGFja2FnZXMvbGludGVyL2xpYi9oZWxwZXJzLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyogQGZsb3cgKi9cblxuaW1wb3J0IGFycmF5VW5pcXVlIGZyb20gJ2xvZGFzaC91bmlxJ1xuaW1wb3J0IHsgRGlzcG9zYWJsZSwgUmFuZ2UsIFBvaW50IH0gZnJvbSAnYXRvbSdcbmltcG9ydCB0eXBlIHsgVGV4dEVkaXRvciB9IGZyb20gJ2F0b20nXG5pbXBvcnQgdHlwZSB7IExpbnRlciwgTWVzc2FnZSB9IGZyb20gJy4vdHlwZXMnXG5cbmV4cG9ydCBjb25zdCAkdmVyc2lvbiA9ICdfXyRzYl9saW50ZXJfdmVyc2lvbidcbmV4cG9ydCBjb25zdCAkYWN0aXZhdGVkID0gJ19fJHNiX2xpbnRlcl9hY3RpdmF0ZWQnXG5leHBvcnQgY29uc3QgJHJlcXVlc3RMYXRlc3QgPSAnX18kc2JfbGludGVyX3JlcXVlc3RfbGF0ZXN0J1xuZXhwb3J0IGNvbnN0ICRyZXF1ZXN0TGFzdFJlY2VpdmVkID0gJ19fJHNiX2xpbnRlcl9yZXF1ZXN0X2xhc3RfcmVjZWl2ZWQnXG5cbmV4cG9ydCBmdW5jdGlvbiBzaG91bGRUcmlnZ2VyTGludGVyKGxpbnRlcjogTGludGVyLCB3YXNUcmlnZ2VyZWRPbkNoYW5nZTogYm9vbGVhbiwgc2NvcGVzOiBBcnJheTxzdHJpbmc+KTogYm9vbGVhbiB7XG4gIGlmICh3YXNUcmlnZ2VyZWRPbkNoYW5nZSAmJiAhbGludGVyLmxpbnRzT25DaGFuZ2UpIHtcbiAgICByZXR1cm4gZmFsc2VcbiAgfVxuICByZXR1cm4gc2NvcGVzLnNvbWUoZnVuY3Rpb24oc2NvcGUpIHtcbiAgICByZXR1cm4gbGludGVyLmdyYW1tYXJTY29wZXMuaW5jbHVkZXMoc2NvcGUpXG4gIH0pXG59XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRFZGl0b3JDdXJzb3JTY29wZXModGV4dEVkaXRvcjogVGV4dEVkaXRvcik6IEFycmF5PHN0cmluZz4ge1xuICByZXR1cm4gYXJyYXlVbmlxdWUoXG4gICAgdGV4dEVkaXRvci5nZXRDdXJzb3JzKCkucmVkdWNlKChzY29wZXMsIGN1cnNvcikgPT4gc2NvcGVzLmNvbmNhdChjdXJzb3IuZ2V0U2NvcGVEZXNjcmlwdG9yKCkuZ2V0U2NvcGVzQXJyYXkoKSksIFsnKiddKSxcbiAgKVxufVxuXG5sZXQgbWluaW1hdGNoXG5leHBvcnQgZnVuY3Rpb24gaXNQYXRoSWdub3JlZChmaWxlUGF0aDogP3N0cmluZywgaWdub3JlZEdsb2I6IHN0cmluZywgaWdub3JlZFZDUzogYm9vbGVhbik6IGJvb2xlYW4ge1xuICBpZiAoIWZpbGVQYXRoKSB7XG4gICAgcmV0dXJuIHRydWVcbiAgfVxuXG4gIGlmIChpZ25vcmVkVkNTKSB7XG4gICAgbGV0IHJlcG9zaXRvcnkgPSBudWxsXG4gICAgY29uc3QgcHJvamVjdFBhdGhzID0gYXRvbS5wcm9qZWN0LmdldFBhdGhzKClcbiAgICBmb3IgKGxldCBpID0gMCwgeyBsZW5ndGggfSA9IHByb2plY3RQYXRoczsgaSA8IGxlbmd0aDsgKytpKSB7XG4gICAgICBjb25zdCBwcm9qZWN0UGF0aCA9IHByb2plY3RQYXRoc1tpXVxuICAgICAgaWYgKGZpbGVQYXRoLmluZGV4T2YocHJvamVjdFBhdGgpID09PSAwKSB7XG4gICAgICAgIHJlcG9zaXRvcnkgPSBhdG9tLnByb2plY3QuZ2V0UmVwb3NpdG9yaWVzKClbaV1cbiAgICAgICAgYnJlYWtcbiAgICAgIH1cbiAgICB9XG4gICAgaWYgKHJlcG9zaXRvcnkgJiYgcmVwb3NpdG9yeS5pc1BhdGhJZ25vcmVkKGZpbGVQYXRoKSkge1xuICAgICAgcmV0dXJuIHRydWVcbiAgICB9XG4gIH1cbiAgY29uc3Qgbm9ybWFsaXplZEZpbGVQYXRoID0gcHJvY2Vzcy5wbGF0Zm9ybSA9PT0gJ3dpbjMyJyA/IGZpbGVQYXRoLnJlcGxhY2UoL1xcXFwvZywgJy8nKSA6IGZpbGVQYXRoXG4gIGlmICghbWluaW1hdGNoKSB7XG4gICAgbWluaW1hdGNoID0gcmVxdWlyZSgnbWluaW1hdGNoJylcbiAgfVxuICByZXR1cm4gbWluaW1hdGNoKG5vcm1hbGl6ZWRGaWxlUGF0aCwgaWdub3JlZEdsb2IpXG59XG5cbmV4cG9ydCBmdW5jdGlvbiBzdWJzY3JpcHRpdmVPYnNlcnZlKG9iamVjdDogT2JqZWN0LCBldmVudE5hbWU6IHN0cmluZywgY2FsbGJhY2s6IEZ1bmN0aW9uKTogRGlzcG9zYWJsZSB7XG4gIGxldCBzdWJzY3JpcHRpb24gPSBudWxsXG4gIGNvbnN0IGV2ZW50U3Vic2NyaXB0aW9uID0gb2JqZWN0Lm9ic2VydmUoZXZlbnROYW1lLCBmdW5jdGlvbihwcm9wcykge1xuICAgIGlmIChzdWJzY3JpcHRpb24pIHtcbiAgICAgIHN1YnNjcmlwdGlvbi5kaXNwb3NlKClcbiAgICB9XG4gICAgc3Vic2NyaXB0aW9uID0gY2FsbGJhY2suY2FsbCh0aGlzLCBwcm9wcylcbiAgfSlcblxuICByZXR1cm4gbmV3IERpc3Bvc2FibGUoZnVuY3Rpb24oKSB7XG4gICAgZXZlbnRTdWJzY3JpcHRpb24uZGlzcG9zZSgpXG4gICAgaWYgKHN1YnNjcmlwdGlvbikge1xuICAgICAgc3Vic2NyaXB0aW9uLmRpc3Bvc2UoKVxuICAgIH1cbiAgfSlcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIG1lc3NhZ2VLZXkobWVzc2FnZTogTWVzc2FnZSkge1xuICBjb25zdCB7IHJlZmVyZW5jZSB9ID0gbWVzc2FnZVxuICByZXR1cm4gW1xuICAgIGAkTElOVEVSOiR7bWVzc2FnZS5saW50ZXJOYW1lfWAsXG4gICAgYCRMT0NBVElPTjoke21lc3NhZ2UubG9jYXRpb24uZmlsZX0kJHttZXNzYWdlLmxvY2F0aW9uLnBvc2l0aW9uLnN0YXJ0LnJvd30kJHttZXNzYWdlLmxvY2F0aW9uLnBvc2l0aW9uLnN0YXJ0LmNvbHVtbn0kJHtcbiAgICAgIG1lc3NhZ2UubG9jYXRpb24ucG9zaXRpb24uZW5kLnJvd1xuICAgIH0kJHttZXNzYWdlLmxvY2F0aW9uLnBvc2l0aW9uLmVuZC5jb2x1bW59YCxcbiAgICByZWZlcmVuY2VcbiAgICAgID8gYCRSRUZFUkVOQ0U6JHtyZWZlcmVuY2UuZmlsZX0kJHtyZWZlcmVuY2UucG9zaXRpb24gPyBgJHtyZWZlcmVuY2UucG9zaXRpb24ucm93fSQke3JlZmVyZW5jZS5wb3NpdGlvbi5jb2x1bW59YCA6ICcnfWBcbiAgICAgIDogJyRSRUZFUkVOQ0U6bnVsbCcsXG4gICAgYCRFWENFUlBUOiR7bWVzc2FnZS5leGNlcnB0fWAsXG4gICAgYCRTRVZFUklUWToke21lc3NhZ2Uuc2V2ZXJpdHl9YCxcbiAgICBtZXNzYWdlLmljb24gPyBgJElDT046JHttZXNzYWdlLmljb259YCA6ICckSUNPTjpudWxsJyxcbiAgICBtZXNzYWdlLnVybCA/IGAkVVJMOiR7bWVzc2FnZS51cmx9YCA6ICckVVJMOm51bGwnLFxuICAgIHR5cGVvZiBtZXNzYWdlLmRlc2NyaXB0aW9uID09PSAnc3RyaW5nJyA/IGAkREVTQ1JJUFRJT046JHttZXNzYWdlLmRlc2NyaXB0aW9ufWAgOiAnJERFU0NSSVBUSU9OOm51bGwnLFxuICBdLmpvaW4oJycpXG59XG5cbmV4cG9ydCBmdW5jdGlvbiBub3JtYWxpemVNZXNzYWdlcyhsaW50ZXJOYW1lOiBzdHJpbmcsIG1lc3NhZ2VzOiBBcnJheTxNZXNzYWdlPikge1xuICBmb3IgKGxldCBpID0gMCwgeyBsZW5ndGggfSA9IG1lc3NhZ2VzOyBpIDwgbGVuZ3RoOyArK2kpIHtcbiAgICBjb25zdCBtZXNzYWdlID0gbWVzc2FnZXNbaV1cbiAgICBjb25zdCB7IHJlZmVyZW5jZSB9ID0gbWVzc2FnZVxuICAgIGlmIChBcnJheS5pc0FycmF5KG1lc3NhZ2UubG9jYXRpb24ucG9zaXRpb24pKSB7XG4gICAgICBtZXNzYWdlLmxvY2F0aW9uLnBvc2l0aW9uID0gUmFuZ2UuZnJvbU9iamVjdChtZXNzYWdlLmxvY2F0aW9uLnBvc2l0aW9uKVxuICAgIH1cbiAgICBpZiAocmVmZXJlbmNlICYmIEFycmF5LmlzQXJyYXkocmVmZXJlbmNlLnBvc2l0aW9uKSkge1xuICAgICAgcmVmZXJlbmNlLnBvc2l0aW9uID0gUG9pbnQuZnJvbU9iamVjdChyZWZlcmVuY2UucG9zaXRpb24pXG4gICAgfVxuICAgIGlmIChtZXNzYWdlLnNvbHV0aW9ucyAmJiBtZXNzYWdlLnNvbHV0aW9ucy5sZW5ndGgpIHtcbiAgICAgIGZvciAobGV0IGogPSAwLCBfbGVuZ3RoID0gbWVzc2FnZS5zb2x1dGlvbnMubGVuZ3RoLCBzb2x1dGlvbjsgaiA8IF9sZW5ndGg7IGorKykge1xuICAgICAgICBzb2x1dGlvbiA9IG1lc3NhZ2Uuc29sdXRpb25zW2pdXG4gICAgICAgIGlmIChBcnJheS5pc0FycmF5KHNvbHV0aW9uLnBvc2l0aW9uKSkge1xuICAgICAgICAgIHNvbHV0aW9uLnBvc2l0aW9uID0gUmFuZ2UuZnJvbU9iamVjdChzb2x1dGlvbi5wb3NpdGlvbilcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICBtZXNzYWdlLnZlcnNpb24gPSAyXG4gICAgaWYgKCFtZXNzYWdlLmxpbnRlck5hbWUpIHtcbiAgICAgIG1lc3NhZ2UubGludGVyTmFtZSA9IGxpbnRlck5hbWVcbiAgICB9XG4gICAgbWVzc2FnZS5rZXkgPSBtZXNzYWdlS2V5KG1lc3NhZ2UpXG4gIH1cbn1cbiJdfQ==